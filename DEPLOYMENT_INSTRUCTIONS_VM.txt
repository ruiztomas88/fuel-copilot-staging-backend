â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      INSTRUCCIONES DE DEPLOYMENT - VM WINDOWS DE PRODUCCIÃ“N                   â•‘
â•‘                    Fuel Analytics Backend v6.3.0                               â•‘
â•‘                         PowerShell Commands                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Fecha: 16 de Enero, 2026
ğŸ¯ Commit: c844e82
âœ… Tests: 3,054/3,054 pasando (100% para tests crÃ­ticos)
ğŸ“Š Coverage: 73% general, 94%+ en mÃ³dulos nuevos
ğŸ”§ Features implementadas:
   1. Slow Siphoning Detector (siphon_detector.py) - 94% coverage
   2. RUL Predictor (rul_predictor.py) - 95% coverage  
   3. MPG Context Engine (mpg_context.py) - 93% coverage

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ NUEVAS FUNCIONALIDADES EN ESTE DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ğŸ” SLOW SIPHONING DETECTOR
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   âœ¨ Detecta robo gradual de combustible (2%/dÃ­a Ã— 5 dÃ­as = 10% acumulativo)
   âœ¨ AnÃ¡lisis de ventana rodante de 7 dÃ­as con detecciÃ³n de patrones
   âœ¨ Scoring de confianza: 50% base + 10%/dÃ­a + bonos
   âœ¨ Ejemplo: LadrÃ³n sifoneando 5 gal/noche Ã— 4 noches = 20 gal detectados
   
   ğŸ’° Impacto financiero:
   - Detecta $500-$2,000/camiÃ³n/aÃ±o en robo gradual
   - Previene pÃ©rdidas a largo plazo que evaden detecciÃ³n instantÃ¡nea
   
   ğŸ“ Archivo: siphon_detector.py
   ğŸ§ª Tests: 11 casos de prueba comprehensivos

2. âš™ï¸ RUL PREDICTOR (Remaining Useful Life)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   âœ¨ MÃºltiples modelos de degradaciÃ³n:
      â€¢ Linear: health = a - b*t (degradaciÃ³n constante)
      â€¢ Exponencial: health = a * exp(-b*t) (degradaciÃ³n acelerada)
   âœ¨ Predice DÃAS y MILLAS hasta fallo del componente
   âœ¨ Scoring de confianza RÂ² para calidad del modelo
   âœ¨ EstimaciÃ³n de costos (turbo: $4,500, aceite: $800, etc.)
   âœ¨ RecomendaciÃ³n de fecha de servicio (7 dÃ­as antes de fallo)
   âœ¨ Umbrales: CrÃ­tico < 25, Advertencia < 50
   
   ğŸ’° Impacto financiero:
   - Ahorro $2,000-$5,000/camiÃ³n/aÃ±o en mantenimiento preventivo
   - Evita fallos catastrÃ³ficos (turbo, transmisiÃ³n)
   - Predicciones accionables: "Turbo falla en 45 dÃ­as, servicio antes del 1 Feb"
   
   ğŸ“ Archivo: rul_predictor.py
   ğŸ§ª Tests: 17 casos de prueba comprehensivos

3. ğŸ›£ï¸ MPG CONTEXT ENGINE
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   âœ¨ MPG base especÃ­fico por ruta:
      â€¢ Autopista: 6.5 MPG
      â€¢ Ciudad: 4.8 MPG
      â€¢ Suburbano: 5.5 MPG
      â€¢ MontaÃ±a: 4.2 MPG
   âœ¨ Factores de carga:
      â€¢ VacÃ­o: +15%
      â€¢ Normal: 1.0
      â€¢ Pesado: -5%
      â€¢ Sobrecargado: -10%
   âœ¨ Factores climÃ¡ticos:
      â€¢ Despejado: 1.0
      â€¢ Lluvia: -5%
      â€¢ Nieve: -10%
      â€¢ FrÃ­o extremo: -12%
   âœ¨ Factores de terreno (basado en cambio de elevaciÃ³n por milla)
   âœ¨ CombinaciÃ³n polinomial: expected_mpg = baseline Ã— route Ã— load Ã— weather Ã— terrain
   âœ¨ ClasificaciÃ³n automÃ¡tica de ruta desde telemetrÃ­a
   âœ¨ Ajuste justo de scoring de conductores
   
   ğŸ’° Impacto operacional:
   - EvaluaciÃ³n justa de conductores (sin penalizaciÃ³n por rutas difÃ­ciles)
   - Mejores predicciones de consumo de combustible
   - Ejemplo: MontaÃ±a + cargado + nieve = 3.36 MPG esperado (vs 6.5 autopista)
   
   ğŸ“ Archivo: mpg_context.py
   ğŸ§ª Tests: 23 casos de prueba comprehensivos
ğŸ’» Sistema: Windows Server VM con PowerShell

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš¡ RESUMEN EJECUTIVO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CAMBIOS CRÃTICOS:
âœ… Circuit Breaker: Sistema sobrevive caÃ­das de DB sin crash
âœ… readings_per_day: Predicciones precisas (antes: error 24x-5760x)
âœ… Baseline Persistence: Baselines guardados en MySQL (antes: se perdÃ­an)
âœ… Geofence System: DetecciÃ³n real vs hardcoded 30%

TIEMPO ESTIMADO DE DEPLOYMENT: 10-15 minutos
DOWNTIME ESPERADO: 2-3 minutos (restart de servicio)
RIESGO: BAJO (cambios testeados, graceful degradation implementado)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PASO 1: BACKUP PRE-DEPLOYMENT (5 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Abrir PowerShell como Administrador
# Conectar a la VM (RDP o PowerShell remoting)

# Navegar al directorio del proyecto
cd C:\FuelAnalytics\Fuel-Analytics-Backend

# Backup de cÃ³digo actual
$timestamp = Get-Date -Format "yyyyMMdd-HHmmss"
Copy-Item -Path "C:\FuelAnalytics\Fuel-Analytics-Backend" -Destination "C:\FuelAnalytics\Fuel-Analytics-Backend.backup-$timestamp" -Recurse

# Verificar que el backup se creÃ³
Get-ChildItem C:\FuelAnalytics\*.backup-* | Select-Object Name, Length, LastWriteTime

# Backup de base de datos (CRÃTICO)
# OpciÃ³n A: Si MySQL estÃ¡ en PATH
$backupFile = "C:\FuelAnalytics\Backups\fuel_analytics_backup_$timestamp.sql"
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqldump.exe" -u root -p fuel_analytics > $backupFile

# OpciÃ³n B: Si necesitas especificar password (SOLO PARA TESTING, usar -p en producciÃ³n)
# & "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqldump.exe" -u root --password=TU_PASSWORD fuel_analytics > $backupFile

# Verificar que el backup existe
Get-Item $backupFile | Select-Object Name, @{Name="SizeMB";Expression={[math]::Round($_.Length/1MB,2)}}, LastWriteTime

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PASO 2: PULL CAMBIOS DESDE GITHUB (2 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

cd C:\FuelAnalytics\Fuel-Analytics-Backend

# Ver rama actual
git branch

# Asegurar que estamos en main
git checkout main

# Pull de los cambios
git pull origin main

# Verificar el commit correcto
git log --oneline -1
# Debe mostrar: 70b4bb0 feat: Complete critical fixes...

# Verificar archivos modificados
git diff HEAD~1 --name-only

DeberÃ­as ver:
  engine_health_engine.py
  fleet_utilization_engine.py
  mpg_engine.py
  theft_detection_engine.py
  routers/engine_health_router.py
  migrations/001_create_baselines_table.py
  migrations/002_create_geofences_table.py
  tests/test_critical_fixes.py
  tests/test_baseline_persistence.py
  tests/test_geofence_system.py
  + mÃ¡s archivos...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PASO 3: EJECUTAR MIGRACIONES DE BASE DE DATOS (3 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ IMPORTANTE: Las migraciones usan CREATE TABLE IF NOT EXISTS
              Si ya existen las tablas, no pasa nada (son idempotentes)

# MigraciÃ³n 1: Tabla de baselines
python migrations\001_create_baselines_table.py

Expected output:
  ğŸ”§ BUG-001 FIX: Creating engine_health_baselines table...
     Creating table...
     âœ… Table created
     Creating indexes...
     âœ… Indexes created
  âœ… Migration completed successfully!

# MigraciÃ³n 2: Tabla de geofences
python migrations\002_create_geofences_table.py

Expected output:
  ğŸ”§ BUG-003 FIX: Creating geofences table...
     Creating table...
     âœ… Table created
     Creating spatial index...
     âœ… Spatial index created
     Inserting sample geofences...
     âœ… Sample data inserted
  âœ… Migration completed successfully!
     Sample geofences: 7

# Verificar tablas creadas (PowerShell con MySQL)
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SHOW TABLES LIKE '%baseline%';"
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SHOW TABLES LIKE '%geofence%';"

# Ver datos de sample en geofences
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SELECT name, location_type, city, state FROM geofences;"

Expected:
  Walmart DC - Bentonville    | customer  | Bentonville | AR
  Amazon Fulfillment - Phoenix| customer  | Phoenix     | AZ
  Home Depot DC - Atlanta     | customer  | Atlanta     | GA
  Main Terminal - Dallas      | terminal  | Dallas      | TX
  ... etc

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PASO 4: EJECUTAR TESTS EN LA VM (3 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ CRÃTICO: Los tests DEBEN pasar antes de restart del servicio

# Instalar pytest si no estÃ¡ (solo primera vez)
pip install pytest pytest-cov

# Ejecutar tests implementados
python -m pytest tests\test_critical_fixes.py tests\test_baseline_persistence.py tests\test_geofence_system.py -v

Expected output:
  ============================== 31 passed in X.XXs ==============================

Si algÃºn test falla:
  âŒ NO CONTINUAR con el deployment
  âŒ Investigar el error
  âŒ Posiblemente hacer rollback

# Test rÃ¡pido de imports (smoke test)
python -c "from theft_detection_engine import TheftPatternAnalyzer; from mpg_engine import predict_maintenance_timing; from engine_health_engine import EngineHealthAnalyzer; from fleet_utilization_engine import FleetUtilizationEngine; print('âœ… All imports successful')"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PASO 5: RESTART DEL SERVICIO WINDOWS (2-3 minutos downtime)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ DOWNTIME ALERT: El servicio estarÃ¡ offline durante 2-3 minutos

OpciÃ³n A: Si el backend corre como Windows Service
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Restart del servicio
Restart-Service -Name "FuelAnalyticsAPI"

# Verificar estado
Get-Service -Name "FuelAnalyticsAPI" | Select-Object Name, Status, StartType

Expected:
  Name              Status  StartType
  ----              ------  ---------
  FuelAnalyticsAPI  Running Automatic

# Ver logs del servicio (Event Viewer)
Get-EventLog -LogName Application -Source "FuelAnalyticsAPI" -Newest 20

OpciÃ³n B: Si usas NSSM (Non-Sucking Service Manager)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Restart con NSSM
nssm restart FuelAnalyticsAPI

# Verificar estado
nssm status FuelAnalyticsAPI

Expected: SERVICE_RUNNING

# Ver logs
Get-Content C:\FuelAnalytics\Logs\fuel-analytics-api.log -Tail 50 -Wait

OpciÃ³n C: Si usas Python directamente (sin servicio)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Detener el proceso actual (si estÃ¡ corriendo)
Get-Process python | Where-Object {$_.Path -like "*FuelAnalytics*"} | Stop-Process -Force

# Iniciar de nuevo
cd C:\FuelAnalytics\Fuel-Analytics-Backend
Start-Process python -ArgumentList "main.py" -NoNewWindow

# O usar uvicorn
Start-Process uvicorn -ArgumentList "main:app --host 0.0.0.0 --port 8000" -NoNewWindow

OpciÃ³n D: Si usas PM2 en Windows
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 restart fuel-analytics-api

# Verificar estado
pm2 status

Expected:
  fuel-analytics-api  online  12345  ...

# Ver logs
pm2 logs fuel-analytics-api --lines 50

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PASO 6: VERIFICACIÃ“N POST-DEPLOYMENT (5 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Health Check (PowerShell)
Invoke-RestMethod -Uri "http://localhost:8000/fuelAnalytics/api/health" -Method Get

Expected:
  status  : healthy
  ...

# Alternativa con curl (si estÃ¡ instalado en Windows)
curl.exe http://localhost:8000/fuelAnalytics/api/health

# 2. Verificar que Circuit Breaker funciona (PowerShell)
Select-String -Path "C:\FuelAnalytics\Logs\fuel-analytics-api.log" -Pattern "circuit" -CaseSensitive:$false | Select-Object -Last 20

# 3. Verificar que baselines se cargan
Select-String -Path "C:\FuelAnalytics\Logs\fuel-analytics-api.log" -Pattern "baseline" -CaseSensitive:$false | Select-Object -Last 20

DeberÃ­as ver:
  ğŸ“¥ Loaded N baselines for TRUCK_ID from DB
  ğŸ’¾ Saved N baselines for TRUCK_ID to DB

# 4. Verificar geofences
Select-String -Path "C:\FuelAnalytics\Logs\fuel-analytics-api.log" -Pattern "geofence" -CaseSensitive:$false | Select-Object -Last 20

DeberÃ­as ver (cuando hay idle en location conocida):
  ğŸ“ Location (36.3729, -94.2088) inside geofence: Walmart DC

# 5. Test endpoint especÃ­fico (DTC)
Invoke-RestMethod -Uri "http://localhost:8000/fuelAnalytics/api/v2/driver-alerts/GP9677/dtc-report" -Method Get

Expected: 200 OK (no 404)

# 6. Test engine health con baselines
Invoke-RestMethod -Uri "http://localhost:8000/fuelAnalytics/api/engine-health/truck/GP9677?include_history=true" -Method Get

Expected: JSON con baselines cargados

# 7. Monitor logs en tiempo real (PowerShell)
Get-Content C:\FuelAnalytics\Logs\fuel-analytics-api.log -Tail 50 -Wait

Buscar seÃ±ales de problemas:
  âŒ "ERROR" (excepto db connection errors esperados durante testing)
  âŒ "CRITICAL"
  âŒ Stack traces
  âœ… "BUG-001", "BUG-002", "BUG-003", "BUG-024" (confirmaciÃ³n de fixes activos)
  âœ… "ğŸ’¾ Saved", "ğŸ“¥ Loaded" (baselines working)
  âœ… "ğŸ“ Location" (geofences working)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PASO 7: TESTING FUNCIONAL DE NUEVAS FEATURES (15 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Test 1: Slow Siphoning Detector
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Verificar que el mÃ³dulo estÃ¡ disponible
python -c "from siphon_detector import SlowSiphonDetector; print('âœ… Siphon Detector OK')"

Expected output:
  âœ… Siphon Detector OK

# Test unitario especÃ­fico
python -m pytest tests\test_siphon_detector.py -v

Expected:
  âœ… 11/11 tests pasando
  âœ… test_siphoning_detected_3_consecutive_days PASSED
  âœ… test_siphoning_high_confidence_consistent_pattern PASSED


Test 2: RUL Predictor
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Verificar que el mÃ³dulo estÃ¡ disponible
python -c "from rul_predictor import RULPredictor; print('âœ… RUL Predictor OK')"

Expected output:
  âœ… RUL Predictor OK

# Test unitario especÃ­fico
python -m pytest tests\test_rul_predictor.py -v

Expected:
  âœ… 17/17 tests pasando
  âœ… test_linear_degradation_prediction PASSED
  âœ… test_exponential_degradation PASSED
  âœ… test_cost_estimation_turbo PASSED


Test 3: MPG Context Engine
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Verificar que el mÃ³dulo estÃ¡ disponible
python -c "from mpg_context import MPGContextEngine; print('âœ… MPG Context Engine OK')"

Expected output:
  âœ… MPG Context Engine OK

# Test unitario especÃ­fico
python -m pytest tests\test_mpg_context.py -v

Expected:
  âœ… 23/23 tests pasando
  âœ… test_highway_empty_clear_optimal PASSED
  âœ… test_route_classification_highway PASSED
  âœ… test_polynomial_combination PASSED


Test 4: Coverage Analysis
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Run full test suite with coverage
python -m pytest tests\ --cov=siphon_detector --cov=rul_predictor --cov=mpg_context --cov-report=term-missing

Expected:
  ğŸ“Š siphon_detector.py: 94% coverage
  ğŸ“Š rul_predictor.py: 95% coverage
  ğŸ“Š mpg_context.py: 93% coverage
  âœ… No critical lines uncovered


Test 5: Integration with Existing Systems
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Verify modules can be imported by main API
python -c "import siphon_detector, rul_predictor, mpg_context; print('âœ… All modules importable')"

Expected output:
  âœ… All modules importable


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ PASO 8: TESTING FUNCIONAL LEGACY (10 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Test 1: Baseline Persistence
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Hacer request a engine health (PowerShell)
Invoke-RestMethod -Uri "http://localhost:8000/fuelAnalytics/api/engine-health/truck/GP9677" -Method Get

# Verificar en DB que se guardÃ³
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SELECT truck_id, sensor_name, mean_value, sample_count FROM engine_health_baselines WHERE truck_id='GP9677';"

Expected: Debe haber filas con oil_pressure_psi, coolant_temp_f, battery_voltage

# Test 2: Circuit Breaker (simular DB failure)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Detener MySQL temporalmente
Stop-Service -Name "MySQL80"

# Hacer request
Invoke-RestMethod -Uri "http://localhost:8000/fuelAnalytics/api/fleet-utilization/summary" -Method Get

# Verificar logs - debe haber fallado gracefully
Select-String -Path "C:\FuelAnalytics\Logs\fuel-analytics-api.log" -Pattern "Circuit" | Select-Object -Last 5

Expected:
  â›” Circuit breaker OPEN - cannot load/persist...

# Restaurar MySQL
Start-Service -Name "MySQL80"

# Test 3: Geofence Detection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ver si hay trucks idle en ubicaciones conocidas
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SELECT unit_id, latitude, longitude, speed_mph FROM telemetria_trucks WHERE speed_mph < 5 AND latitude IS NOT NULL LIMIT 10;"

# Copiar una lat/lon y verificar contra geofences
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SELECT name, center_lat, center_lon, radius_meters FROM geofences LIMIT 5;"

# Test 4: readings_per_day Validation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Verificar que warnings aparezcan si hay datos sospechosos
Select-String -Path "C:\FuelAnalytics\Logs\fuel-analytics-api.log" -Pattern "readings_per_day" | Select-Object -Last 10

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš¨ TROUBLESHOOTING - SI ALGO SALE MAL (Windows PowerShell)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA 1: Servicio no inicia despuÃ©s de restart
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ver logs del servicio
Get-EventLog -LogName Application -Source "FuelAnalyticsAPI" -Newest 100

# Ver archivo de logs
Get-Content C:\FuelAnalytics\Logs\fuel-analytics-api.log -Tail 100

# Verificar sintaxis Python
python -m py_compile theft_detection_engine.py
python -m py_compile mpg_engine.py
python -m py_compile engine_health_engine.py

# Si hay error de sintaxis â†’ ROLLBACK
cd C:\FuelAnalytics
Remove-Item -Path "Fuel-Analytics-Backend" -Recurse -Force
$latestBackup = Get-ChildItem "Fuel-Analytics-Backend.backup-*" | Sort-Object LastWriteTime -Descending | Select-Object -First 1
Rename-Item -Path $latestBackup.FullName -NewName "Fuel-Analytics-Backend"
Restart-Service -Name "FuelAnalyticsAPI"

PROBLEMA 2: Migraciones fallan
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Verificar variables de entorno
Get-ChildItem Env:MYSQL*

# Verificar conexiÃ³n a MySQL
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SELECT 1;"

# Si tabla ya existe (error esperado)
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SHOW TABLES LIKE 'engine_health_baselines';"

Si ya existe â†’ ESTÃ BIEN, continuar

PROBLEMA 3: Tests fallan en VM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Verificar dependencias (PowerShell)
pip list | Select-String -Pattern "pytest|sqlalchemy|pymysql"

# Instalar si falta
pip install pytest sqlalchemy pymysql

# Si falla por DB connection en tests
# â†’ Los tests usan mocks, no deberÃ­an necesitar DB real
# â†’ Verificar imports

PROBLEMA 4: Endpoints devuelven 500
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ver stack trace completo
Get-Content C:\FuelAnalytics\Logs\fuel-analytics-api.log -Tail 100

# Verificar tabla existe
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SHOW TABLES;"

# Test manual de funciÃ³n (PowerShell)
python -c "from database_pool import get_local_engine; engine = get_local_engine(); print(engine)"

Expected: <Engine ...>  # Debe mostrar conexiÃ³n vÃ¡lida

PROBLEMA 5: Baselines no se guardan
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Verificar permisos de tabla
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SHOW GRANTS FOR 'root'@'localhost';"

# Intentar INSERT manual
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "INSERT INTO engine_health_baselines (truck_id, sensor_name, mean_value, std_dev, min_value, max_value, sample_count, days_analyzed) VALUES ('TEST123', 'oil_pressure_psi', 45.0, 5.0, 35.0, 60.0, 100, 30);"

# Verificar que se insertÃ³
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics -e "SELECT * FROM engine_health_baselines WHERE truck_id='TEST123';"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š ROLLBACK PROCEDURE WINDOWS (SI TODO FALLA)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ ÃšLTIMO RECURSO: Solo si deployment causa problemas crÃ­ticos

# 1. Detener servicio
Stop-Service -Name "FuelAnalyticsAPI"

# 2. Restaurar cÃ³digo desde backup
cd C:\FuelAnalytics
Remove-Item -Path "Fuel-Analytics-Backend" -Recurse -Force

# Restaurar desde backup mÃ¡s reciente
$latestBackup = Get-ChildItem "Fuel-Analytics-Backend.backup-*" | Sort-Object LastWriteTime -Descending | Select-Object -First 1
Copy-Item -Path $latestBackup.FullName -Destination "Fuel-Analytics-Backend" -Recurse

# 3. Restaurar base de datos (SOLO SI MIGRACIONES CAUSARON PROBLEMAS)
$latestDbBackup = Get-ChildItem "C:\FuelAnalytics\Backups\fuel_analytics_backup_*.sql" | Sort-Object LastWriteTime -Descending | Select-Object -First 1
& "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p fuel_analytics < $latestDbBackup.FullName

# 4. Restart servicio
Start-Service -Name "FuelAnalyticsAPI"

# 5. Verificar
Invoke-RestMethod -Uri "http://localhost:8000/fuelAnalytics/api/health" -Method Get

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… CHECKLIST FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Pre-Deployment:
â–¡ Backup de cÃ³digo creado (PowerShell)
â–¡ Backup de base de datos creado
â–¡ Git pull exitoso (commit c844e82)

Deployment:
â–¡ MigraciÃ³n 001 (baselines) ejecutada sin errores
â–¡ MigraciÃ³n 002 (geofences) ejecutada sin errores
â–¡ Nuevos mÃ³dulos verificados:
  â–¡ siphon_detector.py importable
  â–¡ rul_predictor.py importable
  â–¡ mpg_context.py importable
â–¡ Tests ejecutados:
  â–¡ 11/11 tests siphon_detector PASSED
  â–¡ 17/17 tests rul_predictor PASSED
  â–¡ 23/23 tests mpg_context PASSED
  â–¡ 3,054 tests totales pasando
â–¡ Coverage verificado:
  â–¡ siphon_detector: 94%+
  â–¡ rul_predictor: 95%+
  â–¡ mpg_context: 93%+
â–¡ Servicio Windows reiniciado exitosamente

Post-Deployment:
â–¡ Health check responde 200 OK (Invoke-RestMethod)
â–¡ Logs muestran "ğŸ’¾ Saved baselines"
â–¡ Logs muestran "ğŸ“¥ Loaded baselines"
â–¡ Logs muestran "ğŸ“ Location inside geofence" (cuando aplica)
â–¡ No hay errors crÃ­ticos en logs (Ãºltimos 100 lines)
â–¡ Endpoints principales funcionan (DTC, engine-health, fleet-utilization)
â–¡ Baselines visibles en MySQL
â–¡ Geofences visibles en MySQL (7 sample geofences)
â–¡ Nuevos mÃ³dulos funcionando:
  â–¡ Siphon detector detecta patrones de robo gradual
  â–¡ RUL predictor genera predicciones de vida Ãºtil
  â–¡ MPG context ajusta expectativas por ruta/clima/carga

Monitoring (Primeras 24 horas):
â–¡ Revisar logs cada 4 horas (Get-Content con -Wait)
â–¡ Verificar que baselines se actualizan
â–¡ Confirmar que no hay circuit breaker OPEN constante
â–¡ Verificar mÃ©tricas de performance (response times)
â–¡ Monitorear nuevas alertas de siphoning si aplican
â–¡ Verificar predicciones RUL para componentes crÃ­ticos
â–¡ Confirmar que MPG context ajusta scoring de conductores

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ CONTACTO & SOPORTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si encuentras problemas:
1. Revisar logs: C:\FuelAnalytics\Logs\fuel-analytics-api.log
2. Verificar IMPLEMENTATION_SUMMARY_v6.2.2.md para detalles tÃ©cnicos
3. Ejecutar tests en VM para diagnÃ³stico
4. En Ãºltimo caso: Rollback procedure (PowerShell)

Archivos de referencia en el repo:
- IMPLEMENTATION_SUMMARY_v6.2.2.md (documentaciÃ³n completa)
- IMPLEMENTATION_PLAN.md (plan original)
- fuel_analytics_config.py (configuraciÃ³n centralizada)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ NOTAS IMPORTANTES PARA WINDOWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. RUTAS DE ARCHIVOS:
   - Backend: C:\FuelAnalytics\Fuel-Analytics-Backend
   - Logs: C:\FuelAnalytics\Logs\fuel-analytics-api.log
   - Backups: C:\FuelAnalytics\Backups\
   - MySQL: C:\Program Files\MySQL\MySQL Server 8.0\bin\

2. SERVICIOS WINDOWS:
   - Nombre del servicio API: "FuelAnalyticsAPI" (ajustar segÃºn tu configuraciÃ³n)
   - Nombre del servicio MySQL: "MySQL80" (ajustar segÃºn versiÃ³n)
   - Comandos: Start-Service, Stop-Service, Restart-Service, Get-Service

3. POWERSHELL TIPS:
   - Ejecutar como Administrador
   - Usar & para ejecutar .exe con espacios en la ruta
   - Variables con $timestamp, $latestBackup, etc.
   - -Recurse para copiar directorios completos

4. MYSQL EN WINDOWS:
   - Siempre usar ruta completa al ejecutable
   - OpciÃ³n -p para password interactivo (mÃ¡s seguro)
   - Evitar --password=XXX en scripts de producciÃ³n

5. PYTHON EN WINDOWS:
   - Usar "python" no "python3"
   - Usar "\" para separadores de ruta (migrations\001_...)
   - pip install (no pip3)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Deployment completado: _____________ (fecha/hora)
âœ… Verificado por: ____________________
âœ… Todo funcionando: â–¡ SÃ  â–¡ NO

Notas:
_____________________________________________________________________________
_____________________________________________________________________________
_____________________________________________________________________________


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Deployment completado: _____________ (fecha/hora)
âœ… Verificado por: ____________________
âœ… Todo funcionando: â–¡ SÃ  â–¡ NO

Notas:
_____________________________________________________________________________
_____________________________________________________________________________
_____________________________________________________________________________
